
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>jobflow &#8212; ADIS2023</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'jobflow';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyiron" href="pyiron_base.html" />
    <link rel="prev" title="AiiDA" href="aiida.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/adislogo.png" class="logo__image only-light" alt="ADIS2023 - Home"/>
    <img src="_static/adislogo.png" class="logo__image only-dark pst-js-only" alt="ADIS2023 - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    ADIS 2023
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="challenges.html">Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="aiida.html">AiiDA</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">jobflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyiron_base.html">pyiron</a></li>



<li class="toctree-l1"><a class="reference internal" href="simstack.html">SimStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="conclusion.html">Conclusion</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/materialdigital/ADIS2023/master?urlpath=lab/tree/jobflow.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/jobflow.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>jobflow</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-setup">Installation / Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-introduction-to-jobflow-concepts">Basic introduction to <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-quantum-espresso-workflow">Implementation of Quantum Espresso Workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#submission-to-an-hpc-check-pointing-error-handling">Submission to an HPC / Check pointing / Error handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-storage-data-sharing">Data Storage / Data Sharing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publication-of-the-workflow">Publication of the workflow</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="jobflow">
<h1>jobflow<a class="headerlink" href="#jobflow" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://materialsproject.github.io/jobflow/index.html"><code class="docutils literal notranslate"><span class="pre">jobflow</span></code></a> and <a class="reference external" href="https://materialsproject.github.io/atomate2/index.html"><code class="docutils literal notranslate"><span class="pre">atomate2</span></code></a> are key packages of the <a class="reference external" href="https://materialsproject.org/">Materials Project</a> . <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> was especially designed to simplify the execution of dynamic workflows – when the actual number of jobs is dynamically determined upon runtime instead of being statically fixed before running the workflow(s). <code class="docutils literal notranslate"><span class="pre">jobflow</span></code>’s overall flexibility allows for building workflows that go beyond the usage in materials science. <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> serves as the basis of <code class="docutils literal notranslate"><span class="pre">atomate2</span></code>, which implements data generation workflows in the context of materials science and will be used for data generation in the Materials Project in the future.</p>
<section id="installation-setup">
<h2>Installation / Setup<a class="headerlink" href="#installation-setup" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">jobflow</span></code> can be installed via <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> and directly run with the default setup. It will then internally rely on a memory database as defined in the software package <a class="reference external" href="https://materialsproject.github.io/maggma/"><code class="docutils literal notranslate"><span class="pre">maggma</span></code></a>. For large-scale usage, a <a class="reference external" href="https://www.mongodb.com/">MongoDB</a>-like database might be specified in a jobflow.yaml file.
A high-throughput setup (i.e., parallel execution of independent parts in the workflow) of <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> can be achieved using additional packages like <a class="reference external" href="https://materialsproject.github.io/fireworks/"><code class="docutils literal notranslate"><span class="pre">fireworks</span></code></a> or <a class="reference external" href="https://matgenix.github.io/jobflow-remote/"><code class="docutils literal notranslate"><span class="pre">jobflow-remote</span></code></a>. Both packages require a MongoDB database. In case of <code class="docutils literal notranslate"><span class="pre">FireWorks</span></code>, however, the MongoDB database needs to be directly connected to the compute nodes. <code class="docutils literal notranslate"><span class="pre">jobflow-remote</span></code> allows remote submission options that only require a MongoDB database on the submitting computer but not the compute nodes. It can also deal with multi-factor authentication.</p>
</section>
<section id="basic-introduction-to-jobflow-concepts">
<h2>Basic introduction to <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> concepts<a class="headerlink" href="#basic-introduction-to-jobflow-concepts" title="Link to this heading">#</a></h2>
<p>Before diving into the simulation code and more details, we need to discuss the core concepts of <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> (written in Python). It defines <code class="docutils literal notranslate"><span class="pre">job</span></code> and <code class="docutils literal notranslate"><span class="pre">Flow</span></code> objects to handle the correct sequential execution of a workflow. A <code class="docutils literal notranslate"><span class="pre">job</span></code> is a class that allows for the delayed execution of a function. Functions can be easily transformed into a <code class="docutils literal notranslate"><span class="pre">job</span></code> with the <code class="docutils literal notranslate"><span class="pre">&#64;job</span></code> decorator, as demonstrated here with a test function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jobflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">job</span>


<span class="nd">@job</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_function</span><span class="p">(</span><span class="n">my_parameter</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">my_parameter</span>


<span class="n">job1</span> <span class="o">=</span> <span class="n">my_function</span><span class="p">(</span><span class="n">my_parameter</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we connect several <code class="docutils literal notranslate"><span class="pre">job</span></code>s to generate a <code class="docutils literal notranslate"><span class="pre">Flow</span></code> object, we can construct a whole workflow. The list of connected <code class="docutils literal notranslate"><span class="pre">jobs</span></code> has to be passed to initialize a <code class="docutils literal notranslate"><span class="pre">Flow</span></code>. The order of the <code class="docutils literal notranslate"><span class="pre">jobs</span></code> is automatically determined by the job connectivity via the <code class="docutils literal notranslate"><span class="pre">job.output</span></code> upon runtime. We can also connect several <code class="docutils literal notranslate"><span class="pre">job</span></code>s and <code class="docutils literal notranslate"><span class="pre">Flows</span></code> to create a new <code class="docutils literal notranslate"><span class="pre">Flow</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jobflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">job</span><span class="p">,</span> <span class="n">Flow</span>


<span class="nd">@job</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_function</span><span class="p">(</span><span class="n">my_parameter</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">my_parameter</span>


<span class="nd">@job</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_second_function</span><span class="p">(</span><span class="n">my_parameter</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">my_parameter</span>


<span class="n">job1</span> <span class="o">=</span> <span class="n">my_function</span><span class="p">(</span><span class="n">my_parameter</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">job2</span> <span class="o">=</span> <span class="n">my_second_function</span><span class="p">(</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<span class="n">flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">([</span><span class="n">job1</span><span class="p">,</span> <span class="n">job2</span><span class="p">],</span> <span class="n">job2</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following simple <a class="reference external" href="https://mermaid.live">Mermaid</a> graph will illustrate the workflow <code class="docutils literal notranslate"><span class="pre">flow</span></code> from the example above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jobflow.utils.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_mermaid</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mm</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
    <span class="n">graphbytes</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="n">base64_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">graphbytes</span><span class="p">)</span>
    <span class="n">base64_string</span> <span class="o">=</span> <span class="n">base64_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://mermaid.ink/img/&quot;</span> <span class="o">+</span> <span class="n">base64_string</span><span class="p">))</span>


<span class="n">graph_source</span> <span class="o">=</span> <span class="n">to_mermaid</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">show_flow_boxes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">mm</span><span class="p">(</span><span class="n">graph_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://mermaid.ink/img/Zmxvd2NoYXJ0IFRECiAgICBhMzU0MTg2OC1kNGQ3LTQ4MDktOTFhMS02NWE5NmM1YmFjMzMobXlfZnVuY3Rpb24pIC0tPnxvdXRwdXR8IDZiYTNiYjhlLTVjNWEtNDA5Ni04NGE5LWZjMGNhNjE0ZmFkMihteV9zZWNvbmRfZnVuY3Rpb24pCiAgICBhMzU0MTg2OC1kNGQ3LTQ4MDktOTFhMS02NWE5NmM1YmFjMzMobXlfZnVuY3Rpb24pCiAgICA2YmEzYmI4ZS01YzVhLTQwOTYtODRhOS1mYzBjYTYxNGZhZDIobXlfc2Vjb25kX2Z1bmN0aW9uKQ=="/></div></div>
</div>
<p>With a so-called <code class="docutils literal notranslate"><span class="pre">Maker</span></code> object, the implementation of <code class="docutils literal notranslate"><span class="pre">job</span></code> and <code class="docutils literal notranslate"><span class="pre">Flow</span></code> objects can be further simplified. It is an extended dataclass object that generates a <code class="docutils literal notranslate"><span class="pre">job</span></code> or <code class="docutils literal notranslate"><span class="pre">Flow</span></code> with the <code class="docutils literal notranslate"><span class="pre">make</span></code> method. Dataclasses are used as they allow defining immutable default values and simplify initialisation of attributes. These <code class="docutils literal notranslate"><span class="pre">Makers</span></code> can then be used to reuse code via the usual inheritance in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jobflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Maker</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyMaker</span><span class="p">(</span><span class="n">Maker</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;My Maker&quot;</span>
    <span class="n">scaling</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.1</span>

    <span class="nd">@job</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">my_parameter</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">my_parameter</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyInheritedMaker</span><span class="p">(</span><span class="n">MyMaker</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;My inherited Maker&quot;</span>


<span class="n">job1</span> <span class="o">=</span> <span class="n">MyMaker</span><span class="p">()</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">my_parameter</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">job2</span> <span class="o">=</span> <span class="n">MyInheritedMaker</span><span class="p">()</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">my_parameter</span><span class="o">=</span><span class="n">job1</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When faced with dynamic workflows (where the number of jobs is unclear before execution) a <code class="docutils literal notranslate"><span class="pre">Response</span></code> object instead of a <code class="docutils literal notranslate"><span class="pre">job</span></code> or <code class="docutils literal notranslate"><span class="pre">Flow</span></code> object can be returned. There are several options to insert the new list of jobs into the <code class="docutils literal notranslate"><span class="pre">Response</span></code> object.</p>
</section>
<section id="implementation-of-quantum-espresso-workflow">
<h2>Implementation of Quantum Espresso Workflow<a class="headerlink" href="#implementation-of-quantum-espresso-workflow" title="Link to this heading">#</a></h2>
<p>We will use this knowledge to implement the Quantum Espresso-related tasks for calculating an “Energy vs. Volume” curve. It’s important to note that this is only a basic implementation, and further extensions towards data validation or for a simplified user experience can be added. For example, one can typically configure run commands for quantum-chemical programs via configuration files in atomate2.</p>
<blockquote>
<div><p>ℹ️ Note: all outputs of a job need to be transformable into a JSON-like format. Therefore, we use a pymatgen <code class="docutils literal notranslate"><span class="pre">MSONAtoms</span></code> object here instead of an ase <code class="docutils literal notranslate"><span class="pre">Atoms</span></code> object. <code class="docutils literal notranslate"><span class="pre">MSONAtoms</span></code> inherits from the Python package monty’s MSONable class allowing an easy serialization into a <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
</div></blockquote>
<p>For building the Quantum Espresso (QE)-related tasks, we start by importing essential tools to be able to create and navigate directories (<code class="docutils literal notranslate"><span class="pre">os</span></code>) and execute programs like the QE binary (<code class="docutils literal notranslate"><span class="pre">subprocess</span></code>). <code class="docutils literal notranslate"><span class="pre">pydantic</span></code> is very convenient for validating all kinds of data types. These Pydantic models can then also be directly used for API development as part of <a class="reference external" href="https://fastapi.tiangolo.com/">FAST-API</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we import tools for data plotting as well as mathematical operations and manipulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>ASE provides us with a method to create bulk crystal systems and a writer to handle output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ase.build</span><span class="w"> </span><span class="kn">import</span> <span class="n">bulk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ase.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write</span>
</pre></div>
</div>
</div>
</div>
<p>Additionally, we take the QE XML output parser written for this tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">adis_tools.parsers</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_pw</span>
</pre></div>
</div>
</div>
</div>
<p>To calculate a (E, V) curve with QE, we implement a function that applies a certain strain to the original structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.ase</span><span class="w"> </span><span class="kn">import</span> <span class="n">MSONAtoms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ase</span><span class="w"> </span><span class="kn">import</span> <span class="n">Atoms</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_structures</span><span class="p">(</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Atoms</span><span class="p">,</span> <span class="n">strain_lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<span class="p">):</span>  <span class="c1"># structure should be of ase Atoms type</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="n">MSONAtoms</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
    <span class="n">structure_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">strain</span> <span class="ow">in</span> <span class="n">strain_lst</span><span class="p">:</span>
        <span class="n">structure_strain</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">structure_strain</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span>
            <span class="n">structure_strain</span><span class="o">.</span><span class="n">cell</span> <span class="o">*</span> <span class="n">strain</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="n">scale_atoms</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">structure_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structure_strain</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">structure_lst</span>
</pre></div>
</div>
</div>
</div>
<p>Then we define a function to plot and save the (E, V) curve as a PNG file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_energy_volume_curve</span><span class="p">(</span><span class="n">volume_lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">energy_lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">volume_lst</span><span class="p">,</span> <span class="n">energy_lst</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Volume&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;evcurve.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we need a function to write the QE input files. The <code class="docutils literal notranslate"><span class="pre">input_dict</span></code> has to contain all essential input information like the structure, the pseudopotentials, the number of kpoints, the calculation type and the smearing type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">write_input</span><span class="p">(</span><span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;input.pwi&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">write</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">images</span><span class="o">=</span><span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">],</span>
        <span class="n">Crystal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">kpts</span><span class="o">=</span><span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;kpts&quot;</span><span class="p">],</span>
        <span class="n">input_data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;calculation&quot;</span><span class="p">:</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;calculation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;occupations&quot;</span><span class="p">:</span> <span class="s2">&quot;smearing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;degauss&quot;</span><span class="p">:</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;smearing&quot;</span><span class="p">],</span>
        <span class="p">},</span>
        <span class="n">pseudopotentials</span><span class="o">=</span><span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;pseudopotentials&quot;</span><span class="p">],</span>
        <span class="n">tstress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tprnfor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we also need to define a function to collect the output from the QE calculation to pass it to <code class="docutils literal notranslate"><span class="pre">plot_energy_volume_curve</span></code> in order to plot the actual figure. Here we make use of the ADIS QE XML output parser <code class="docutils literal notranslate"><span class="pre">parse_pw</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">collect_output</span><span class="p">(</span><span class="n">working_directory</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">parse_pw</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;pwscf.xml&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="n">MSONAtoms</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;ase_structure&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span>
        <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;ase_structure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_volume</span><span class="p">(),</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we need to systematically handle the QE input. We make use of the pymatgen <code class="docutils literal notranslate"><span class="pre">InputSet</span></code> and <code class="docutils literal notranslate"><span class="pre">InputGenerator</span></code> classes to control and define the input data format. The <code class="docutils literal notranslate"><span class="pre">QEInputSet</span></code> defines the input information format which will be followed by the <code class="docutils literal notranslate"><span class="pre">QEInputGenerator</span></code>. We also define an extra <code class="docutils literal notranslate"><span class="pre">QEInputStaticGenerator</span></code> class (inheriting from <code class="docutils literal notranslate"><span class="pre">QEInputGenerator</span></code>) to be able to separately handle the static QE calculations for every strained structure in a convenient way.  Finally, we define the function <code class="docutils literal notranslate"><span class="pre">write_qe_input_set</span></code> to write the QE input files into the current working directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">InputSet</span><span class="p">,</span> <span class="n">InputGenerator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QEInputSet</span><span class="p">(</span><span class="n">InputSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes an QE input based on an input_dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dict</span> <span class="o">=</span> <span class="n">input_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">working_directory</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
        <span class="n">write_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">working_directory</span><span class="o">=</span><span class="n">working_directory</span><span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QEInputGenerator</span><span class="p">(</span><span class="n">InputGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates an QE input based on the format given in QEInputSet.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pseudopotentials</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Al&quot;</span><span class="p">:</span> <span class="s2">&quot;Al.pbe-n-kjpaw_psl.1.0.0.UPF&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">kpts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">calculation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;vc-relax&quot;</span>
    <span class="n">smearing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_input_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QEInputSet</span><span class="p">:</span>

        <span class="n">input_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="n">structure</span><span class="p">,</span>
            <span class="s2">&quot;pseudopotentials&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudopotentials</span><span class="p">,</span>
            <span class="s2">&quot;kpts&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpts</span><span class="p">,</span>
            <span class="s2">&quot;calculation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculation</span><span class="p">,</span>
            <span class="s2">&quot;smearing&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">smearing</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">QEInputSet</span><span class="p">(</span><span class="n">input_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QEInputStaticGenerator</span><span class="p">(</span><span class="n">QEInputGenerator</span><span class="p">):</span>
    <span class="n">calculation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;scf&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">write_qe_input_set</span><span class="p">(</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Atoms</span><span class="p">,</span>
    <span class="n">input_set_generator</span><span class="p">:</span> <span class="n">InputGenerator</span> <span class="o">=</span> <span class="n">QEInputGenerator</span><span class="p">(),</span>
    <span class="n">working_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">qis</span> <span class="o">=</span> <span class="n">input_set_generator</span><span class="o">.</span><span class="n">get_input_set</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
    <span class="n">qis</span><span class="o">.</span><span class="n">write_input</span><span class="p">(</span><span class="n">working_directory</span><span class="o">=</span><span class="n">working_directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The next steps are all about handling the execution of QE and the output data collection. We start by defining a QE task document <code class="docutils literal notranslate"><span class="pre">QETaskDoc</span></code> to systematically collect the output data. For the (E, V) curve, the energy and volume are of course the most important information. The task document could be further extended to contain other relevant information. Next, we define a <code class="docutils literal notranslate"><span class="pre">BaseQEMaker</span></code> to handle generic QE jobs (in our case for the structural relaxation) and a separate <code class="docutils literal notranslate"><span class="pre">StaticQEMaker</span></code> for the static QE calculations. The <code class="docutils literal notranslate"><span class="pre">BaseQEMaker</span></code> is expecting the generic input set generated by <code class="docutils literal notranslate"><span class="pre">QEInputGenerator</span></code>, while <code class="docutils literal notranslate"><span class="pre">StaticQEMaker</span></code> expects the <code class="docutils literal notranslate"><span class="pre">QEInputStaticGenerator</span></code> type. As the <code class="docutils literal notranslate"><span class="pre">StaticQEMaker</span></code> inherits from the <code class="docutils literal notranslate"><span class="pre">BaseQEMaker</span></code>, we only need to make sure to pass the correct input set generator type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jobflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">job</span><span class="p">,</span> <span class="n">Maker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>


<span class="n">QE_CMD</span> <span class="o">=</span> <span class="s2">&quot;mpirun -np 1 pw.x -in input.pwi &gt; output.pwo&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">run_qe</span><span class="p">(</span><span class="n">qe_cmd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">QE_CMD</span><span class="p">):</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">qe_cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QETaskDoc</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">structure</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MSONAtoms</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ASE structure&quot;</span><span class="p">)</span>
    <span class="n">energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;DFT energy in eV&quot;</span><span class="p">)</span>
    <span class="n">volume</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;volume in Angstrom^3&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">collect_output</span><span class="p">(</span><span class="n">working_directory</span><span class="o">=</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="c1"># structure object needs to be serializable, i.e., we need an additional transformation</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">],</span>
            <span class="n">energy</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span>
            <span class="n">volume</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">],</span>
        <span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseQEMaker</span><span class="p">(</span><span class="n">Maker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base QE job maker.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The job name.</span>
<span class="sd">    input_set_generator : .QEInputGenerator</span>
<span class="sd">        A generator used to make the input set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;base qe job&quot;</span>
    <span class="n">input_set_generator</span><span class="p">:</span> <span class="n">QEInputGenerator</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">QEInputGenerator</span><span class="p">)</span>

    <span class="nd">@job</span><span class="p">(</span><span class="n">output_schema</span><span class="o">=</span><span class="n">QETaskDoc</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Atoms</span> <span class="o">|</span> <span class="n">MSONAtoms</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QETaskDoc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a QE calculation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure : MSONAtoms|Atoms</span>
<span class="sd">            An Atoms or MSONAtoms object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Output of a QE calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># copy previous inputs</span>

        <span class="c1"># write qe input files</span>
        <span class="n">write_qe_input_set</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span> <span class="n">input_set_generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_set_generator</span>
        <span class="p">)</span>

        <span class="c1"># run the QE software</span>
        <span class="n">run_qe</span><span class="p">()</span>

        <span class="c1"># parse QE outputs in form of a task document</span>
        <span class="n">task_doc</span> <span class="o">=</span> <span class="n">QETaskDoc</span><span class="o">.</span><span class="n">from_directory</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">task_doc</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StaticQEMaker</span><span class="p">(</span><span class="n">BaseQEMaker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base QE job maker.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The job name.</span>
<span class="sd">    input_set_generator : .QEInputGenerator</span>
<span class="sd">        A generator used to make the input set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;static qe job&quot;</span>
    <span class="n">input_set_generator</span><span class="p">:</span> <span class="n">QEInputGenerator</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">QEInputStaticGenerator</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, it’s time to orchestrate all functions and classes together into an actual flow. Note how the number of jobs in <code class="docutils literal notranslate"><span class="pre">get_ev_curve</span></code> can be flexibly controlled by using <code class="docutils literal notranslate"><span class="pre">strain_lst</span></code> and therefore we use a <code class="docutils literal notranslate"><span class="pre">Response</span></code> object to handle the flexible job output. By making <code class="docutils literal notranslate"><span class="pre">get_ev_curve</span></code> and <code class="docutils literal notranslate"><span class="pre">plot_energy_volume_curve_job</span></code> into <code class="docutils literal notranslate"><span class="pre">job</span></code> objects using the <code class="docutils literal notranslate"><span class="pre">&#64;job</span></code> decorator, we ensure that first all the (E, V) data points are calculated before they are plotted. The <code class="docutils literal notranslate"><span class="pre">qe_flow</span></code> contains the list of the jobs that need to be executed in this workflow. The jobs are connected by the respective <code class="docutils literal notranslate"><span class="pre">job.output</span></code> objects that also ensures the correct order in executing the jobs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jobflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">job</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">run_locally</span>

<span class="c1"># set up QE PP env</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;ESPRESSO_PSEUDO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/espresso/pseudo&quot;</span>


<span class="nd">@job</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_ev_curve</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n">Atoms</span> <span class="o">|</span> <span class="n">MSONAtoms</span><span class="p">,</span> <span class="n">strain_lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">float</span><span class="p">)):</span>
    <span class="n">structures</span> <span class="o">=</span> <span class="n">generate_structures</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">strain_lst</span><span class="o">=</span><span class="n">strain_lst</span><span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">istructure</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strain_lst</span><span class="p">)):</span>
        <span class="n">new_job</span> <span class="o">=</span> <span class="n">StaticQEMaker</span><span class="p">()</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structures</span><span class="p">[</span><span class="n">istructure</span><span class="p">])</span>
        <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_job</span><span class="p">)</span>
        <span class="n">volumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_job</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>
        <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_job</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
        <span class="n">replace</span><span class="o">=</span><span class="n">Flow</span><span class="p">(</span><span class="n">jobs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="n">energies</span><span class="p">,</span> <span class="s2">&quot;volumes&quot;</span><span class="p">:</span> <span class="n">volumes</span><span class="p">})</span>
    <span class="p">)</span>


<span class="nd">@job</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_energy_volume_curve_job</span><span class="p">(</span><span class="n">volume_lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">energy_lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">float</span><span class="p">)):</span>
    <span class="n">plot_energy_volume_curve</span><span class="p">(</span><span class="n">volume_lst</span><span class="o">=</span><span class="n">volume_lst</span><span class="p">,</span> <span class="n">energy_lst</span><span class="o">=</span><span class="n">energy_lst</span><span class="p">)</span>


<span class="n">structure</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Al&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">4.15</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">relax</span> <span class="o">=</span> <span class="n">BaseQEMaker</span><span class="p">()</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">MSONAtoms</span><span class="p">(</span><span class="n">structure</span><span class="p">))</span>
<span class="n">ev_curve_data</span> <span class="o">=</span> <span class="n">get_ev_curve</span><span class="p">(</span>
    <span class="n">relax</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="n">strain_lst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># structure optimization job and (E, V) curve data job connected via relax.output</span>
<span class="n">plot_curve</span> <span class="o">=</span> <span class="n">plot_energy_volume_curve_job</span><span class="p">(</span>
    <span class="n">volume_lst</span><span class="o">=</span><span class="n">ev_curve_data</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;volumes&quot;</span><span class="p">],</span>
    <span class="n">energy_lst</span><span class="o">=</span><span class="n">ev_curve_data</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># (E, V) curve data job and plotting the curve job connected via ev_curve_data.output</span>
<span class="n">qe_flow</span> <span class="o">=</span> <span class="p">[</span><span class="n">relax</span><span class="p">,</span> <span class="n">ev_curve_data</span><span class="p">,</span> <span class="n">plot_curve</span><span class="p">]</span>
<span class="n">qe_fw</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">(</span><span class="n">qe_flow</span><span class="p">)</span>
<span class="c1"># qe_flow is the QE flow that consists of the job for structural optimization, calculating the (E, V) curve data points and plotting the curve</span>
<span class="n">run_locally</span><span class="p">(</span>
    <span class="n">qe_fw</span><span class="p">,</span> <span class="n">create_folders</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>  <span class="c1"># order of the jobs in the flow determined by connectivity</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">to_mermaid</span><span class="p">(</span><span class="n">qe_fw</span><span class="p">,</span> <span class="n">show_flow_boxes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mm</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-07-03 13:59:45,257 INFO Started executing jobs locally
2024-07-03 13:59:45,266 INFO Starting job - base qe job (fb7e4f95-15fe-4ae0-aa3b-3d0f5dc8b65a)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: The following floating-point exceptions are signalling: IEEE_INVALID_FLAG
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-07-03 14:00:31,075 INFO Finished job - base qe job (fb7e4f95-15fe-4ae0-aa3b-3d0f5dc8b65a)
2024-07-03 14:00:31,078 INFO Starting job - get_ev_curve (8df443c4-f690-4c1b-9126-8455b6458d9d)
2024-07-03 14:00:31,099 INFO Finished job - get_ev_curve (8df443c4-f690-4c1b-9126-8455b6458d9d)
2024-07-03 14:00:31,105 INFO Starting job - static qe job (8c2ce097-6b17-43dd-9f03-d4477338688b)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: The following floating-point exceptions are signalling: IEEE_INVALID_FLAG
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-07-03 14:00:37,026 INFO Finished job - static qe job (8c2ce097-6b17-43dd-9f03-d4477338688b)
2024-07-03 14:00:37,029 INFO Starting job - static qe job (046ab976-1dc9-4b45-816d-86297a209912)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: The following floating-point exceptions are signalling: IEEE_INVALID_FLAG
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-07-03 14:00:43,878 INFO Finished job - static qe job (046ab976-1dc9-4b45-816d-86297a209912)
2024-07-03 14:00:43,883 INFO Starting job - static qe job (2e1199a8-12c0-4df0-afdc-2543f0a1652b)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: The following floating-point exceptions are signalling: IEEE_INVALID_FLAG
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-07-03 14:00:50,753 INFO Finished job - static qe job (2e1199a8-12c0-4df0-afdc-2543f0a1652b)
2024-07-03 14:00:50,759 INFO Starting job - static qe job (b6118649-654f-445c-ba44-091c6bf6a5af)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: The following floating-point exceptions are signalling: IEEE_INVALID_FLAG
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-07-03 14:00:58,591 INFO Finished job - static qe job (b6118649-654f-445c-ba44-091c6bf6a5af)
2024-07-03 14:00:58,598 INFO Starting job - static qe job (ed35e52e-fd72-495a-ae7f-4f2f949d8031)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: The following floating-point exceptions are signalling: IEEE_INVALID_FLAG
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-07-03 14:01:06,332 INFO Finished job - static qe job (ed35e52e-fd72-495a-ae7f-4f2f949d8031)
2024-07-03 14:01:06,337 INFO Starting job - store_inputs (8df443c4-f690-4c1b-9126-8455b6458d9d, 2)
2024-07-03 14:01:06,340 INFO Finished job - store_inputs (8df443c4-f690-4c1b-9126-8455b6458d9d, 2)
2024-07-03 14:01:06,343 INFO Starting job - plot_energy_volume_curve_job (4bb64989-7cc3-4dc4-900f-19c10d959dfa)
2024-07-03 14:01:06,497 INFO Finished job - plot_energy_volume_curve_job (4bb64989-7cc3-4dc4-900f-19c10d959dfa)
2024-07-03 14:01:06,498 INFO Finished executing jobs locally
</pre></div>
</div>
<div class="output text_html"><img src="https://mermaid.ink/img/Zmxvd2NoYXJ0IFRECiAgICBmYjdlNGY5NS0xNWZlLTRhZTAtYWEzYi0zZDBmNWRjOGI2NWEoYmFzZSBxZSBqb2IpCiAgICA4ZGY0NDNjNC1mNjkwLTRjMWItOTEyNi04NDU1YjY0NThkOWQoZ2V0X2V2X2N1cnZlKQogICAgNGJiNjQ5ODktN2NjMy00ZGM0LTkwMGYtMTljMTBkOTU5ZGZhKHBsb3RfZW5lcmd5X3ZvbHVtZV9jdXJ2ZV9qb2Ip"/></div><img alt="_images/8ea39410c04f4b3e8fd43ec5db9a7f384b4ae10d98bbab697713fb2dc339ecc0.png" src="_images/8ea39410c04f4b3e8fd43ec5db9a7f384b4ae10d98bbab697713fb2dc339ecc0.png" />
</div>
</div>
<p>And with using the <code class="docutils literal notranslate"><span class="pre">job.output</span></code> connectivity, the mermaid graph looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mm</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">flowchart TD</span>
<span class="sd">    6883bfe0-2b20-49de-92df-c166d6f91dbc(base qe job) --&gt; |output.structure| dfc9a5cd-fb91-4582-b6c6-c42b4c65cb83(get_ev_curve)</span>
<span class="sd">    dfc9a5cd-fb91-4582-b6c6-c42b4c65cb83(get_ev_curve) --&gt; |&#39;volumes&#39;, &#39;energies&#39;| 92d14a25-bb90-4c86-b970-af05db90550e(plot_energy_volume_curve_job)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><img src="https://mermaid.ink/img/CmZsb3djaGFydCBURAogICAgNjg4M2JmZTAtMmIyMC00OWRlLTkyZGYtYzE2NmQ2ZjkxZGJjKGJhc2UgcWUgam9iKSAtLT4gfG91dHB1dC5zdHJ1Y3R1cmV8IGRmYzlhNWNkLWZiOTEtNDU4Mi1iNmM2LWM0MmI0YzY1Y2I4MyhnZXRfZXZfY3VydmUpCiAgICBkZmM5YTVjZC1mYjkxLTQ1ODItYjZjNi1jNDJiNGM2NWNiODMoZ2V0X2V2X2N1cnZlKSAtLT4gfCd2b2x1bWVzJywgJ2VuZXJnaWVzJ3wgOTJkMTRhMjUtYmI5MC00Yzg2LWI5NzAtYWYwNWRiOTA1NTBlKHBsb3RfZW5lcmd5X3ZvbHVtZV9jdXJ2ZV9qb2IpCg=="/></div></div>
</div>
</section>
<section id="submission-to-an-hpc-check-pointing-error-handling">
<h2>Submission to an HPC / Check pointing / Error handling<a class="headerlink" href="#submission-to-an-hpc-check-pointing-error-handling" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> command <code class="docutils literal notranslate"><span class="pre">run_locally</span></code> to run jobs in serial with a simple job script</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">fireworks</span></code> and <code class="docutils literal notranslate"><span class="pre">jobflow-remote</span></code> to simplify and parallelize the submission of jobs, and allows for checkpointing</p></li>
<li><p>Use <a class="reference external" href="http://materialsproject.github.io/custodian/"><code class="docutils literal notranslate"><span class="pre">custodian</span></code></a> error handling (not directly handled by <code class="docutils literal notranslate"><span class="pre">jobflow</span></code>), e.g. like in <code class="docutils literal notranslate"><span class="pre">atomate2</span></code></p></li>
</ul>
</section>
<section id="data-storage-data-sharing">
<h2>Data Storage / Data Sharing<a class="headerlink" href="#data-storage-data-sharing" title="Link to this heading">#</a></h2>
<p>Key data can be saved in a dedicated MongoDB-like database. This data can be validated with the help of
<code class="docutils literal notranslate"><span class="pre">pydantic</span></code>. The latter also allows a direct connection to Fast-API. The Materials Project data generation
relies on similar features. Direct calculation outputs will be saved on the compute machine.
There are no dedicated mechanisms to save whole projects, but the database can be used to achieve this.</p>
</section>
<section id="publication-of-the-workflow">
<h2>Publication of the workflow<a class="headerlink" href="#publication-of-the-workflow" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> infrastructure does not provide a dedicated platform for publishing a workflow currently. However, workflows related to computational materials science have been collected in the package <code class="docutils literal notranslate"><span class="pre">atomate2</span></code>. In addition, users can build their own package by relying on <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> and share it as a new Python-based program. There are also additional materials science packages like <a class="reference external" href="https://github.com/BlauGroup/NanoParticleTools">NanoParticleTools</a> or <a class="reference external" href="https://github.com/Quantum-Accelerators/quacc">QuAcc</a> that rely on <code class="docutils literal notranslate"><span class="pre">jobflow</span></code>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="aiida.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">AiiDA</p>
      </div>
    </a>
    <a class="right-next"
       href="pyiron_base.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">pyiron</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-setup">Installation / Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-introduction-to-jobflow-concepts">Basic introduction to <code class="docutils literal notranslate"><span class="pre">jobflow</span></code> concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-quantum-espresso-workflow">Implementation of Quantum Espresso Workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#submission-to-an-hpc-check-pointing-error-handling">Submission to an HPC / Check pointing / Error handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-storage-data-sharing">Data Storage / Data Sharing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#publication-of-the-workflow">Publication of the workflow</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Marnik Bercx, Christina Ertural, Janine George, Jan Janssen, Joerg Schaarschmidt
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>